#include "font.h"
#include "uart.h"



   

// 16x16 font data - placeholder array (font data removed)
// Use extracted font data from FON file instead
__code u8 font_16x16_data[FONT_16X16_CHAR_COUNT][FONT_16X16_BYTES_PER_CHAR] = {
    // Placeholder - all characters empty
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00}
    // Add more placeholder entries as needed
};

// Forward declarations for LCD functions



// Function to render a 16x16 character
void render_16x16_char(u8 x, u8 y, char c) {
    if (c < 0x20 || c > 0x7E) return;  // ASCII printable characters only
    u8 idx = c - 0x20;  // Index starts from space character

    // IMPORTANT: explicit code-space pointer
    const __code u8 *glyph = &font_16x16_data[idx][0];

    lcd_set_window(x, y, x + FONT_16X16_WIDTH - 1, y + FONT_16X16_HEIGHT - 1);

    for (u8 row = 0; row < FONT_16X16_HEIGHT; row++) {
        // two bytes per row: left 8, right 8
        u8 b0 = glyph[row * 2 + 0];
        u8 b1 = glyph[row * 2 + 1];
        u16 row_data = ((u16)b0 << 8) | b1; // MSB = leftmost pixel

        for (u8 col = 0; col < FONT_16X16_WIDTH; col++) {
            if (row_data & (0x8000 >> col)) {
                lcd_send_data(0xFF); // white hi
                lcd_send_data(0xFF); // white lo
            } else {
                lcd_send_data(0x00); // black hi
                lcd_send_data(0x00); // black lo
            }
        }
    }
}


// Render a string using 16x16 font
void render_16x16_string(u8 x, u8 y, const char *str) {
    u8 current_x = x;
    
    while (*str && current_x < DISPLAY_WIDTH - FONT_16X16_WIDTH) {
        if (*str >= 0x20 && *str <= 0x7E) {  // All printable ASCII characters
            render_16x16_char(current_x, y, *str);
            current_x += FONT_16X16_WIDTH; // No extra spacing between characters
        }
        str++;
    }
}



// Render a number using 16x16 font
static __code const u16 powers_of_10[] = {10000, 1000, 100, 10, 1};

void render_16x16_number(u8 x, u8 y, u16 number) {
    u8 started = 0;
    for (u8 p = 0; p < 5; p++) {
        u8 digit = 0;
        while (number >= powers_of_10[p]) {
            number -= powers_of_10[p];
            digit++;
        }
        if (digit || started || p == 4) {
            render_16x16_char(x, y, '0' + digit);
            x += FONT_16X16_WIDTH + 2;
            started = 1;
        }
    }
}






// Clear a rectangular area of the display

// Demonstration of both fonts
void dual_font_demo(void) {
    // Clear the display
    clear_area(0, 0, DISPLAY_WIDTH - 1, DISPLAY_HEIGHT - 1);
    
    // Display using 16x16 font
    render_16x16_string(5, 5, "16x16 Font");
    render_16x16_string(10, 25, "Hello World!");
    render_16x16_string(10, 45, "ABC 123");
    render_16x16_number(10, 65, 7890);
    
    // Wait and show 32x32 font
    delay_ms(30, 0);  // 3 second delay
    clear_area(0, 0, DISPLAY_WIDTH - 1, DISPLAY_HEIGHT - 1);
    
    // Display using 32x32 font
    render_32x32_string(5, 5, "32x32");
    render_32x32_string(5, 45, "BIG");
    render_32x32_number(5, 85, 42);
}

// Test individual fonts
void test_fonts_separate(void) {
    // Test 16x16 font
    clear_area(0, 0, 79, 127);
    render_16x16_string(5, 10, "16x16 Test");
    render_16x16_string(5, 30, "ABCDEFGH");
    render_16x16_string(5, 50, "abcd1234");
    render_16x16_string(5, 70, "!@#$%^&*");
    render_16x16_number(5, 90, 2024);
    
}

//=============================================================================
// 32x32 SCALED FONT FUNCTIONS (2x scaling of 16x16)
//=============================================================================

// Function to render a 32x32 character (2x scaled 16x16)
void render_32x32_char(u8 x, u8 y, char c) {
    if (c < 0x20 || c > 0x7E) return;  // ASCII printable characters only
    u8 idx = c - 0x20;  // Index starts from space character

    // IMPORTANT: explicit code-space pointer
    const __code u8 *glyph = &font_16x16_data[idx][0];

    lcd_set_window(x, y, x + FONT_32X32_WIDTH - 1, y + FONT_32X32_HEIGHT - 1);

    // Process each row of the 16x16 source font
    for (u8 row = 0; row < FONT_16X16_HEIGHT; row++) {
        // Get the two bytes for this row (left 8 bits, right 8 bits)
        u8 b0 = glyph[row * 2 + 0];
        u8 b1 = glyph[row * 2 + 1];
        u16 row_data = ((u16)b0 << 8) | b1; // MSB = leftmost pixel
        
        // Render this row twice (2x vertical scaling)
        for (u8 scale_row = 0; scale_row < 2; scale_row++) {
            // Process each column of the 16-bit row
            for (u8 col = 0; col < FONT_16X16_WIDTH; col++) {
                u8 pixel_on = (row_data & (0x8000 >> col)) ? 1 : 0;
                
                // Render this pixel twice (2x horizontal scaling)
                for (u8 scale_col = 0; scale_col < 2; scale_col++) {
                    if (pixel_on) {
                        lcd_send_data(0xFF); // white hi
                        lcd_send_data(0xFF); // white lo
                    } else {
                        lcd_send_data(0x00); // black hi
                        lcd_send_data(0x00); // black lo
                    }
                }
            }
        }
    }
}

// Render a string using 32x32 font
void render_32x32_string(u8 x, u8 y, const char *str) {
    u8 current_x = x;
    
    while (*str && current_x < DISPLAY_WIDTH - FONT_32X32_WIDTH) {
        if (*str >= 0x20 && *str <= 0x7E) {  // All printable ASCII characters
            render_32x32_char(current_x, y, *str);
            current_x += FONT_32X32_WIDTH; // No extra spacing between characters
        }
        str++;
    }
}

// Render a number using 32x32 font
void render_32x32_number(u8 x, u8 y, u16 number) {
    char buffer[6];
    u8 i = 0;
    u16 temp = number;

    if (number == 0) {
        render_32x32_char(x, y, '0');
        return;
    }

    // Convert number to string (reverse order)
    while (temp > 0 && i < 5) {
        buffer[i++] = '0' + (temp % 10);
        temp /= 10;
    }

    // Render digits in correct order
    u8 current_x = x;
    while (i > 0 && current_x < DISPLAY_WIDTH - FONT_32X32_WIDTH) {
        render_32x32_char(current_x, y, buffer[--i]);
        current_x += FONT_32X32_WIDTH + 4; // Add 4 pixel spacing
    }
}

//=============================================================================
// 16x8 FONT DATA AND FUNCTIONS
//=============================================================================

// 16x8 font data for ASCII characters 0x20-0x7E (space to tilde)  
// Each character is 16 pixels wide, 8 pixels high
// Format: 16 bytes per character (2 bytes per row, 8 rows)
// Each row: [left_8_bits, right_8_bits]

__code u8 font_16x8_data[95][16] = {
    // Space (0x20) 
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    
    // ! (0x21)
    {0x00,0x00,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00},
    
    // " (0x22)
    {0x00,0x00,0x06,0x60,0x06,0x60,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    
    // # (0x23) 
    {0x06,0x60,0x06,0x60,0x1F,0xF8,0x06,0x60,0x1F,0xF8,0x06,0x60,0x06,0x60,0x00,0x00},
    
    // $ (0x24)
    {0x01,0x80,0x0F,0xF0,0x18,0x00,0x0F,0xF0,0x00,0x18,0x0F,0xF0,0x01,0x80,0x00,0x00},
    
    // % (0x25)
    {0x18,0x60,0x18,0xC0,0x01,0x80,0x03,0x00,0x06,0x18,0x0C,0x18,0x00,0x00,0x00,0x00},
    
    // & (0x26)
    {0x07,0x00,0x0C,0x80,0x0D,0x80,0x07,0x00,0x0D,0x80,0x0C,0x80,0x07,0x80,0x00,0x00},
    
    // ' (0x27)
    {0x00,0x00,0x01,0x80,0x01,0x80,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    
    // ( (0x28)
    {0x00,0xC0,0x01,0x80,0x03,0x00,0x03,0x00,0x03,0x00,0x01,0x80,0x00,0xC0,0x00,0x00},
    
    // ) (0x29)
    {0x03,0x00,0x01,0x80,0x00,0xC0,0x00,0xC0,0x00,0xC0,0x01,0x80,0x03,0x00,0x00,0x00},
    
    // * (0x2A)
    {0x00,0x00,0x01,0x80,0x0D,0xB0,0x07,0xE0,0x0D,0xB0,0x01,0x80,0x00,0x00,0x00,0x00},
    
    // + (0x2B)
    {0x00,0x00,0x01,0x80,0x01,0x80,0x0F,0xF0,0x01,0x80,0x01,0x80,0x00,0x00,0x00,0x00},
    
    // , (0x2C)
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x80,0x03,0x00,0x00,0x00},
    
    // - (0x2D)
    {0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    
    // . (0x2E)
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x01,0x80,0x01,0x80,0x00,0x00},
    
    // / (0x2F)
    {0x00,0x18,0x00,0x30,0x00,0x60,0x00,0xC0,0x01,0x80,0x03,0x00,0x06,0x00,0x00,0x00},
    
    // 0 (0x30)
    {0x07,0xE0,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x07,0xE0,0x00,0x00},
    
    // 1 (0x31)
    {0x01,0x80,0x03,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x07,0xE0,0x00,0x00},
    
    // 2 (0x32)
    {0x07,0xE0,0x0C,0x30,0x00,0x30,0x00,0x60,0x00,0xC0,0x01,0x80,0x0F,0xF0,0x00,0x00},
    
    // 3 (0x33)
    {0x07,0xE0,0x0C,0x30,0x00,0x30,0x01,0xE0,0x00,0x30,0x0C,0x30,0x07,0xE0,0x00,0x00},
    
    // 4 (0x34)
    {0x00,0x60,0x00,0xE0,0x01,0x60,0x02,0x60,0x0F,0xF0,0x00,0x60,0x00,0x60,0x00,0x00},
    
    // 5 (0x35)
    {0x0F,0xF0,0x0C,0x00,0x0C,0x00,0x0F,0xE0,0x00,0x30,0x0C,0x30,0x07,0xE0,0x00,0x00},
    
    // 6 (0x36)
    {0x03,0xE0,0x06,0x00,0x0C,0x00,0x0F,0xE0,0x0C,0x30,0x0C,0x30,0x07,0xE0,0x00,0x00},
    
    // 7 (0x37)
    {0x0F,0xF0,0x00,0x30,0x00,0x60,0x00,0xC0,0x01,0x80,0x03,0x00,0x03,0x00,0x00,0x00},
    
    // 8 (0x38)
    {0x07,0xE0,0x0C,0x30,0x0C,0x30,0x07,0xE0,0x0C,0x30,0x0C,0x30,0x07,0xE0,0x00,0x00},
    
    // 9 (0x39)
    {0x07,0xE0,0x0C,0x30,0x0C,0x30,0x07,0xF0,0x00,0x30,0x00,0x60,0x07,0xC0,0x00,0x00},
    
    // : (0x3A)
    {0x00,0x00,0x01,0x80,0x01,0x80,0x00,0x00,0x01,0x80,0x01,0x80,0x00,0x00,0x00,0x00},
    
    // ; (0x3B)
    {0x00,0x00,0x01,0x80,0x01,0x80,0x00,0x00,0x01,0x80,0x01,0x80,0x03,0x00,0x00,0x00},
    
    // < (0x3C)
    {0x00,0x60,0x00,0xC0,0x01,0x80,0x03,0x00,0x01,0x80,0x00,0xC0,0x00,0x60,0x00,0x00},
    
    // = (0x3D)
    {0x00,0x00,0x00,0x00,0x0F,0xF0,0x00,0x00,0x0F,0xF0,0x00,0x00,0x00,0x00,0x00,0x00},
    
    // > (0x3E)
    {0x06,0x00,0x03,0x00,0x01,0x80,0x00,0xC0,0x01,0x80,0x03,0x00,0x06,0x00,0x00,0x00},
    
    // ? (0x3F)
    {0x07,0xE0,0x0C,0x30,0x00,0x60,0x00,0xC0,0x01,0x80,0x00,0x00,0x01,0x80,0x00,0x00},
    
    // @ (0x40)
    {0x07,0xE0,0x0C,0x30,0x0D,0xF0,0x0D,0xF0,0x0D,0x00,0x0C,0x00,0x07,0xF0,0x00,0x00},
    
    // A (0x41)
    {0x07,0xE0,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0F,0xF0,0x0C,0x30,0x0C,0x30,0x00,0x00},
    
    // B (0x42)
    {0x0F,0xE0,0x0C,0x30,0x0C,0x30,0x0F,0xE0,0x0C,0x30,0x0C,0x30,0x0F,0xE0,0x00,0x00},
    
    // C (0x43)
    {0x07,0xE0,0x0C,0x30,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x30,0x07,0xE0,0x00,0x00},
    
    // D (0x44)
    {0x0F,0xC0,0x0C,0x60,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0C,0x60,0x0F,0xC0,0x00,0x00},
    
    // E (0x45)
    {0x0F,0xF0,0x0C,0x00,0x0C,0x00,0x0F,0xE0,0x0C,0x00,0x0C,0x00,0x0F,0xF0,0x00,0x00},
    
    // F (0x46)
    {0x0F,0xF0,0x0C,0x00,0x0C,0x00,0x0F,0xE0,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x00,0x00},
    
    // G (0x47)
    {0x07,0xE0,0x0C,0x30,0x0C,0x00,0x0C,0xF0,0x0C,0x30,0x0C,0x30,0x07,0xF0,0x00,0x00},
    
    // H (0x48)
    {0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0F,0xF0,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x00,0x00},
    
    // I (0x49)
    {0x07,0xE0,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x07,0xE0,0x00,0x00},
    
    // J (0x4A)
    {0x00,0xF0,0x00,0x60,0x00,0x60,0x00,0x60,0x0C,0x60,0x0C,0x60,0x07,0xC0,0x00,0x00},
    
    // K (0x4B)
    {0x0C,0x60,0x0C,0xC0,0x0D,0x80,0x0F,0x00,0x0D,0x80,0x0C,0xC0,0x0C,0x60,0x00,0x00},
    
    // L (0x4C)
    {0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x0F,0xF0,0x00,0x00},
    
    // M (0x4D)
    {0x0C,0x30,0x0F,0xF0,0x0F,0xF0,0x0D,0xB0,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x00,0x00},
    
    // N (0x4E)
    {0x0C,0x30,0x0E,0x30,0x0F,0x30,0x0D,0xB0,0x0C,0xF0,0x0C,0x70,0x0C,0x30,0x00,0x00},
    
    // O (0x4F)
    {0x07,0xE0,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x07,0xE0,0x00,0x00},
    
    // P (0x50)
    {0x0F,0xE0,0x0C,0x30,0x0C,0x30,0x0F,0xE0,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x00,0x00},
    
    // Q (0x51)
    {0x07,0xE0,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0D,0x30,0x0C,0x60,0x07,0xF0,0x00,0x00},
    
    // R (0x52)
    {0x0F,0xE0,0x0C,0x30,0x0C,0x30,0x0F,0xE0,0x0C,0x60,0x0C,0x30,0x0C,0x30,0x00,0x00},
    
    // S (0x53)
    {0x07,0xF0,0x0C,0x00,0x0C,0x00,0x07,0xE0,0x00,0x30,0x00,0x30,0x0F,0xE0,0x00,0x00},
    
    // T (0x54)
    {0x0F,0xF0,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x00,0x00},
    
    // U (0x55)
    {0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x07,0xE0,0x00,0x00},
    
    // V (0x56)
    {0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x06,0x60,0x03,0xC0,0x01,0x80,0x00,0x00},
    
    // W (0x57)
    {0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0D,0xB0,0x0F,0xF0,0x0F,0xF0,0x0C,0x30,0x00,0x00},
    
    // X (0x58)
    {0x0C,0x30,0x06,0x60,0x03,0xC0,0x01,0x80,0x03,0xC0,0x06,0x60,0x0C,0x30,0x00,0x00},
    
    // Y (0x59)
    {0x0C,0x30,0x0C,0x30,0x06,0x60,0x03,0xC0,0x01,0x80,0x01,0x80,0x01,0x80,0x00,0x00},
    
    // Z (0x5A)
    {0x0F,0xF0,0x00,0x60,0x00,0xC0,0x01,0x80,0x03,0x00,0x06,0x00,0x0F,0xF0,0x00,0x00},
    
    // [ (0x5B)
    {0x03,0xC0,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0x00,0x03,0xC0,0x00,0x00},
    
    // \ (0x5C)
    {0x06,0x00,0x03,0x00,0x01,0x80,0x00,0xC0,0x00,0x60,0x00,0x30,0x00,0x18,0x00,0x00},
    
    // ] (0x5D)
    {0x03,0xC0,0x00,0xC0,0x00,0xC0,0x00,0xC0,0x00,0xC0,0x00,0xC0,0x03,0xC0,0x00,0x00},
    
    // ^ (0x5E)
    {0x01,0x80,0x03,0xC0,0x06,0x60,0x0C,0x30,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    
    // _ (0x5F)
    {0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x0F,0xF0,0x00,0x00},
    
    // ` (0x60)
    {0x03,0x00,0x01,0x80,0x00,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
    
    // a (0x61)
    {0x00,0x00,0x00,0x00,0x07,0xE0,0x00,0x30,0x07,0xF0,0x0C,0x30,0x07,0xF0,0x00,0x00},
    
    // b (0x62)
    {0x0C,0x00,0x0C,0x00,0x0F,0xE0,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0F,0xE0,0x00,0x00},
    
    // c (0x63)
    {0x00,0x00,0x00,0x00,0x07,0xE0,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x07,0xE0,0x00,0x00},
    
    // d (0x64)
    {0x00,0x30,0x00,0x30,0x07,0xF0,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x07,0xF0,0x00,0x00},
    
    // e (0x65)
    {0x00,0x00,0x00,0x00,0x07,0xE0,0x0C,0x30,0x0F,0xF0,0x0C,0x00,0x07,0xF0,0x00,0x00},
    
    // f (0x66)
    {0x01,0xE0,0x03,0x00,0x03,0x00,0x0F,0xC0,0x03,0x00,0x03,0x00,0x03,0x00,0x00,0x00},
    
    // g (0x67)
    {0x00,0x00,0x07,0xF0,0x0C,0x30,0x0C,0x30,0x07,0xF0,0x00,0x30,0x07,0xE0,0x00,0x00},
    
    // h (0x68)
    {0x0C,0x00,0x0C,0x00,0x0F,0xE0,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x00,0x00},
    
    // i (0x69)
    {0x01,0x80,0x00,0x00,0x03,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x03,0xC0,0x00,0x00},
    
    // j (0x6A)
    {0x00,0xC0,0x00,0x00,0x01,0xC0,0x00,0xC0,0x00,0xC0,0x0C,0xC0,0x07,0x80,0x00,0x00},
    
    // k (0x6B)
    {0x0C,0x00,0x0C,0x00,0x0C,0x60,0x0C,0xC0,0x0F,0x80,0x0C,0xC0,0x0C,0x60,0x00,0x00},
    
    // l (0x6C)
    {0x03,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x03,0xC0,0x00,0x00},
    
    // m (0x6D)
    {0x00,0x00,0x00,0x00,0x0F,0xF0,0x0D,0xB0,0x0D,0xB0,0x0D,0xB0,0x0D,0xB0,0x00,0x00},
    
    // n (0x6E)
    {0x00,0x00,0x00,0x00,0x0F,0xE0,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x00,0x00},
    
    // o (0x6F)
    {0x00,0x00,0x00,0x00,0x07,0xE0,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x07,0xE0,0x00,0x00},
    
    // p (0x70)
    {0x00,0x00,0x0F,0xE0,0x0C,0x30,0x0C,0x30,0x0F,0xE0,0x0C,0x00,0x0C,0x00,0x00,0x00},
    
    // q (0x71)
    {0x00,0x00,0x07,0xF0,0x0C,0x30,0x0C,0x30,0x07,0xF0,0x00,0x30,0x00,0x30,0x00,0x00},
    
    // r (0x72)
    {0x00,0x00,0x00,0x00,0x0F,0x60,0x0C,0xC0,0x0C,0x00,0x0C,0x00,0x0C,0x00,0x00,0x00},
    
    // s (0x73)
    {0x00,0x00,0x00,0x00,0x07,0xF0,0x0C,0x00,0x07,0xE0,0x00,0x30,0x0F,0xE0,0x00,0x00},
    
    // t (0x74)
    {0x03,0x00,0x03,0x00,0x0F,0xC0,0x03,0x00,0x03,0x00,0x03,0x00,0x01,0xE0,0x00,0x00},
    
    // u (0x75)
    {0x00,0x00,0x00,0x00,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x0C,0x30,0x07,0xF0,0x00,0x00},
    
    // v (0x76)
    {0x00,0x00,0x00,0x00,0x0C,0x30,0x0C,0x30,0x06,0x60,0x03,0xC0,0x01,0x80,0x00,0x00},
    
    // w (0x77)
    {0x00,0x00,0x00,0x00,0x0C,0x30,0x0D,0xB0,0x0D,0xB0,0x0D,0xB0,0x06,0x60,0x00,0x00},
    
    // x (0x78)
    {0x00,0x00,0x00,0x00,0x0C,0x30,0x06,0x60,0x03,0xC0,0x06,0x60,0x0C,0x30,0x00,0x00},
    
    // y (0x79)
    {0x00,0x00,0x0C,0x30,0x0C,0x30,0x06,0x60,0x03,0xC0,0x01,0x80,0x03,0x00,0x00,0x00},
    
    // z (0x7A)
    {0x00,0x00,0x00,0x00,0x0F,0xF0,0x00,0x60,0x01,0x80,0x06,0x00,0x0F,0xF0,0x00,0x00},
    
    // { (0x7B)
    {0x00,0xE0,0x01,0x80,0x01,0x80,0x03,0x00,0x01,0x80,0x01,0x80,0x00,0xE0,0x00,0x00},
    
    // | (0x7C)
    {0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x00,0x00},
    
    // } (0x7D)
    {0x07,0x00,0x01,0x80,0x01,0x80,0x00,0xC0,0x01,0x80,0x01,0x80,0x07,0x00,0x00,0x00},
    
    // ~ (0x7E)
    {0x00,0x00,0x00,0x00,0x06,0x20,0x0D,0xB0,0x09,0x90,0x04,0x60,0x00,0x00,0x00,0x00}
};

// Function definitions for 16x8 font
void render_16x8_char(u8 x, u8 y, char c) {
    if (c < 0x20 || c > 0x7E) return;  // ASCII printable characters only
    u8 idx = c - 0x20;  // Index starts from space character

    // IMPORTANT: explicit code-space pointer
    const __code u8 *glyph = &font_16x8_data[idx][0];

    lcd_set_window(x, y, x + 15, y + 7);  // 16x8 window

    for (u8 row = 0; row < 8; row++) {
        // Two bytes per row: left 8, right 8
        u8 b0 = glyph[row * 2 + 0];
        u8 b1 = glyph[row * 2 + 1];
        u16 row_data = ((u16)b0 << 8) | b1; // MSB = leftmost pixel

        for (u8 col = 0; col < 16; col++) {
            if (row_data & (0x8000 >> col)) {
                lcd_send_data(0xFF); // white hi
                lcd_send_data(0xFF); // white lo
            } else {
                lcd_send_data(0x00); // black hi
                lcd_send_data(0x00); // black lo
            }
        }
    }
}

void render_16x8_string(u8 x, u8 y, const char *str) {
    u8 current_x = x;
    
    while (*str) {
        if (current_x + 16 > DISPLAY_WIDTH) break; // Stop if next char would go off screen
        if (*str >= 0x20 && *str <= 0x7E) {  // All printable ASCII characters
            render_16x8_char(current_x, y, *str);
            current_x += 12; // 12 pixel spacing
        }
        str++;
    }
}

void render_16x8_number(u8 x, u8 y, u16 number) {
    u8 started = 0;
    u8 current_x = x;
    
    for (u8 p = 0; p < 5; p++) {
        u8 digit = 0;
        while (number >= powers_of_10[p]) {
            number -= powers_of_10[p];
            digit++;
        }
        if (digit || started || p == 4) { // Show digit if non-zero, already started, or last digit (always show at least one digit)
            if (current_x + 16 > DISPLAY_WIDTH) break; // Stop if next char would go off screen
            render_16x8_char(current_x, y, '0' + digit);
            current_x += 12; // 12 pixel spacing for numbers too
            started = 1;
        }
    }
}